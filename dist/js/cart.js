"use strict";$(".address span").hover(function(){$(".explain").css("display","block")},function(){$(".explain").css("display","none")});var coo=tool.getCookie("username");function allche(){$(".menuLeft input").click(function(){$(this).prop("checked")?$(".cartcontent input").prop("checked",!0):$(".cartcontent input").prop("checked",!1),jiesuan(),checkbg()}),$(".operation input").click(function(){$(this).prop("checked")?($(".cartcontent input").prop("checked",!0),$(".menuLeft input").prop("checked",!0)):($(".cartcontent input").prop("checked",!1),$(".menuLeft input").prop("checked",!1)),jiesuan(),checkbg()}),$(".shop .name input").click(function(){$(this).prop("checked")?$(this).parent().next().find("input").prop("checked",!0):$(this).parent().next().find("input").prop("checked",!1),che(),jiesuan(),checkbg()}),$(".shop .goods input").click(function(){che(),littleche(this),checkbg()})}function checkbg(){$(".shop .goods input[type=checkbox]").each(function(t,n){$(n).prop("checked")?$(n).parent().parent().css("background","#FFF1E8"):$(n).parent().parent().css("background","#FFF")})}function che(){var e=0;$(".shop input[type=checkbox]").each(function(t,n){$(n).prop("checked")&&e++}),e==$(".shop input[type=checkbox]").length?($(".menuLeft input").prop("checked",!0),$(".operation input").prop("checked",!0)):($(".menuLeft input").prop("checked",!1),$(".operation input").prop("checked",!1))}function littleche(t){var e=0,n=$(t).parent().parent().parent().find("input[type=checkbox]").length;$(t).parent().parent().parent().find("input[type=checkbox]").each(function(t,n){$(n).prop("checked")&&e++}),e==n?$(t).parent().parent().parent().prev().find("input").prop("checked",!0):$(t).parent().parent().parent().prev().find("input").prop("checked",!1),che(),jiesuan()}function addnum(){$(".goods ul .li4 span:nth-child(1)").click(function(){$(this).parent().parent().parent().find(".li1 input").prop("checked",!0);var t=$(this).next().val();if(--t<1)return t=1,$(this).css("color","#999"),layer.msg("不能再少啦！"),!1;$(this).css("color","#000"),$(this).next().val(t);var n=$(this).parent().parent().prev().text().slice(1)-0;$(this).parent().parent().next().text("￥"+n*t+".00");var e=$(this).parent().parent().parent().attr("cart-id"),c=tool.getCookie("username");0<t&&$.ajax({url:"http://store/src/php/addcart.php",data:{goodsId:e,username:c,num:-1},dataType:"json",type:"post"}),jiesuan()}),$(".goods ul .li4 span:nth-child(3)").click(function(){$(this).parent().parent().parent().find(".li1 input").prop("checked",!0);var t=$(this).prev().val();if(10<++t)return t=10,$(this).css("color","#999"),layer.msg("限购十件！"),!1;$(this).css("color","#000"),$(this).prev().val(t);var n=$(this).parent().parent().prev().text().slice(1)-0;$(this).parent().parent().next().text("￥"+n*t+".00");var e=$(this).parent().parent().parent().attr("cart-id"),c=tool.getCookie("username");t<=11&&$.ajax({url:"http://store/src/php/addcart.php",data:{goodsId:e,username:c,num:1},dataType:"json",type:"post"}),jiesuan()})}function jiesuan(){var e=0;$(".shop .goods ul .li5").each(function(t,n){$(n).parent().find(".li1 input").prop("checked")&&(e+=$(n).text().slice(1)-0)}),$(".menuRight b").text("￥"+e+".00")}function initckeck(){$("input[type=checkbox]").prop("checked",!0),$("input[type=checkbox]").each(function(t,n){$(n).prop("checked")&&jiesuan()}),checkbg()}function delche(){$(".goods ul .li6 p:first-child").click(function(){var n=this;layer.confirm("您确定删除吗？",{btn:["确定","取消"]},function(){var t=$(n).parent().parent().attr("cart-id");coo=tool.getCookie("username"),$.ajax({url:"http://store/src/php/cart.php",data:{goodsId:t,user:coo},dataType:"json",type:"post"}).then(function(t){layer.msg(t.meta.message,{icon:1}),1==t.meta.status&&(1==$(n).parent().parent().parent().children().length?$(n).parent().parent().parent().parent().remove():$(n).parent().parent().remove(),emptycart(),jiesuan())})})}),$(".menuLeft>span").click(function(){var e=0;if($(".goods input[type=checkbox]").each(function(t,n){$(n).prop("checked")&&e++}),!e)return layer.msg("没有删除项！"),!1;layer.confirm("您确定删除所选项吗？",{btn:["确定","取消"]},function(){coo=tool.getCookie("username");var e=[];$(".goods input[type=checkbox]").each(function(t,n){$(n).prop("checked")&&e.push($(n).parent().parent().attr("cart-id"))});var t=e.join(",");$.ajax({url:"http://store/src/php/cart.php",data:{user:coo,goodsId:t},dataType:"json",type:"post"}).then(function(t){layer.msg(t.meta.message,{icon:1}),1==t.meta.status&&($(".goods input[type=checkbox]").each(function(t,n){$(n).prop("checked")&&$(n).parent().parent().remove()}),$(".goods").each(function(t,n){0==$(n).children().length&&$(n).parent().remove()}),emptycart(),jiesuan())})})})}function emptycart(){0==$(".shop").length&&($(".cart").css("display","none"),$(".settlement").css("display","none"),$(".emptyCart").css("display","block"))}window.onscroll=function(){document.documentElement.scrollTop<200?$(".settlement").css({position:"fixed",bottom:"-20px"}):$(".settlement").css({position:"inherit"}),document.body.scrollHeight<window.innerHeight+200&&$(".settlement").css({position:"inherit"})},null!=coo?($(".top_nav_left li:first-child a").html("Hi,"+coo+'<i class="iconfont">&#xe60c;</i>'),$(".top_nav_left li:last-child").css("display","none"),$(".top_nav_left li:nth-child(2) a:first-child").css("display","none"),$(".top_nav_left li:first-child div").html('\n        <div>头像</div>\n        <p>Hi,<b style="color:red;">'+coo+"</b>,欢迎来到真快乐！</p>    \n    ")):$(".top_nav_left li:nth-child(2) a:last-child").css("display","none"),$(".top_nav_left li:nth-child(2) a:last-child").click(function(){layer.confirm("您确定退出吗？",{btn:["确定","取消"]},function(){layer.msg("退出成功！",{time:1500}),tool.removeCookie("username"),$(".top_nav_left li:first-child a").html('真快乐会员<i class="iconfont">&#xe60c;</i>'),$(".top_nav_left li:last-child").css("display","block"),$(".top_nav_left li:nth-child(2) a:last-child").css("display","none"),$(".top_nav_left li:nth-child(2) a:first-child").css("display","block"),$(".top_nav_left li:first-child div").html('\n            <div>头像</div>\n            <p>欢迎来到真快乐，<a href="login.html">请登录！</a></p>\n        '),$(".cart").attr("data-attr","×")})}),$.ajax({url:"http://store/src/php/list.php",data:{username:coo},dataType:"json",type:"post"}).then(function(a){var n=[];a.forEach(function(t){n.push(t.goodsId)});var t=n.join(",");$.ajax({url:"http://store/src/php/list.php",data:{id:t},dataType:"json",type:"post"}).then(function(o){var n=[];o.forEach(function(t){n.push(t.brand+t.shop)});var e={};for(var t in n.forEach(function(t){e[t]=0}),n=[],e)n.push(t);n.forEach(function(t){var n=$('<div class="shop"></div>'),e=$('\n                <div class="name">\n                    <input type="checkbox" name="" id="">\n                    <b>国美'+t+'旗舰店</b>\n                    <i class="iconfont">&#xe7bb;</i>\n                    <span>在线客服</span>\n                </div>\n            '),i=$('<div class="goods clear"></div>'),c=[],p=t.slice(0,2);o.forEach(function(t){t.brand==p&&c.push(t)}),c.forEach(function(n){var e=void 0,c=void 0;a.forEach(function(t){n.id==t.goodsId&&(e=t.num-0,c=t.goodsId)});var t=$('\n                    <ul class="clear" cart-id="'+c+'">\n                        <li class="li1">\n                            <input type="checkbox">\n                            <img src="'+n.imgUrl+'" alt="">\n                        </li>\n                        <li class="li2">\n                            <p>'+n.content+'</p>\n                        </li>\n                        <li class="li3">￥'+n.price+'</li>\n                        <li class="li4">\n                            <div>\n                                <span>-</span>\n                                <input type="text" value="'+e+'" disabled>\n                                <span>+</span>\n                            </div>\n                        </li>\n                        <li class="li5">￥'+(n.price-0)*e+'.00</li>\n                        <li class="li6">\n                            <p>删除</p>\n                            <p>移入收藏夹</p>\n                        </li>\n                    </ul>\n                ');i.append(t)}),n.append(e).append(i),$(".cart").append(n)}),allche(),addnum(),initckeck(),delche()})}).catch(function(){emptycart()}),$(".logo").click(function(){location.href="index.html"});